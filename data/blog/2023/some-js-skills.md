---
title: 'jsä¸­çš„é‚£äº›æŠ€æœ¯ç‚¹'
date: Sat May 13 2023 23:13:13 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)
lastmod: '2023-05-13'
tags: ['js']
draft: false
summary: 'å“ªäº›jsä¸­çš„æŠ€èƒ½ç‚¹'
layout: PostSimple
bibliography: references-data.bib
canonicalUrl: https://dume.vercel.app/blog/2023/some-js-skills
---

## æ‰§è¡Œä¸Šä¸‹æ–‡

JavaScript çš„æ‰§è¡Œä¸Šä¸‹æ–‡æ˜¯æè¿° JavaScript ä»£ç åœ¨è¿è¡Œæ—¶ç¯å¢ƒä¸­æ‰§è¡Œçš„æŠ½è±¡æ¦‚å¿µã€‚å®ƒæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«äº† JavaScript ä»£ç æ‰§è¡Œæ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ï¼Œä¾‹å¦‚å˜é‡ã€å‡½æ•°ã€å‚æ•°ã€ä½œç”¨åŸŸé“¾ç­‰ã€‚

JavaScript ä¸­çš„æ¯ä¸ªå‡½æ•°éƒ½æœ‰è‡ªå·±çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œè€Œå…¨å±€ä»£ç åœ¨ JavaScript å¼•æ“å¯åŠ¨æ—¶åˆ›å»ºäº†ä¸€ä¸ªå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚

å½“ JavaScript ä»£ç è¢«æ‰§è¡Œæ—¶ï¼ŒJavaScript å¼•æ“ä¼šåˆ›å»ºä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡å †æ ˆï¼ˆExecution Context Stackï¼‰ã€‚æ¯æ¬¡è°ƒç”¨å‡½æ•°æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå¹¶å°†å…¶æ¨å…¥å †æ ˆçš„é¡¶éƒ¨ã€‚å½“å‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œå®ƒçš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¼šä»å †æ ˆä¸­å¼¹å‡ºï¼Œæ‰§è¡Œä¸Šä¸‹æ–‡å †æ ˆä¼šå›åˆ°ä¸Šä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡ã€‚

JavaScript æ‰§è¡Œä¸Šä¸‹æ–‡åŒ…å«çš„ä¿¡æ¯æœ‰ï¼š

1. å˜é‡å¯¹è±¡ï¼ˆVariable Objectï¼‰ï¼šå­˜å‚¨æ‰€æœ‰çš„å±€éƒ¨å˜é‡ã€å‡½æ•°å£°æ˜å’Œå‡½æ•°å‚æ•°ï¼Œä»¥åŠå…¨å±€å˜é‡ï¼ˆåœ¨å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ï¼‰ã€‚
2. ä½œç”¨åŸŸé“¾ï¼ˆScope Chainï¼‰ï¼šåœ¨æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ï¼Œå®ƒæ˜¯ä¸€ä¸ªæŒ‡å‘å½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡å’Œä¸Šå±‚æ‰§è¡Œä¸Šä¸‹æ–‡çš„ä½œç”¨åŸŸé“¾çš„æŒ‡é’ˆåˆ—è¡¨ã€‚
3. this æŒ‡é’ˆï¼šæŒ‡å‘å½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡çš„å¯¹è±¡ã€‚

å½“ JavaScript å¼•æ“æ‰§è¡Œä»£ç æ—¶ï¼Œå®ƒä¼šæ ¹æ®æ‰§è¡Œä¸Šä¸‹æ–‡å †æ ˆä¸­çš„å½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡æ¥ç¡®å®šå½“å‰ä»£ç çš„ä½œç”¨åŸŸå’Œå˜é‡ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå‡½æ•°å†…éƒ¨å¯ä»¥è®¿é—®å¤–éƒ¨å˜é‡ï¼Œä½†å¤–éƒ¨ä¸èƒ½è®¿é—®å‡½æ•°å†…éƒ¨å˜é‡çš„åŸå› ã€‚

### è¯æ³•ä½œç”¨åŸŸ

JavaScript ä¸­çš„è¯æ³•ä½œç”¨åŸŸæ˜¯æŒ‡å˜é‡å’Œå‡½æ•°çš„ä½œç”¨åŸŸæ˜¯åœ¨ä»£ç ç¼–å†™æ—¶é™æ€ç¡®å®šçš„ã€‚æ¢å¥è¯è¯´ï¼Œè¯æ³•ä½œç”¨åŸŸæ˜¯ç”±ä»£ç ä¸­å˜é‡å’Œå‡½æ•°å®šä¹‰çš„ä½ç½®å†³å®šçš„ï¼Œä¸ä»£ç çš„æ‰§è¡Œé¡ºåºæ— å…³ã€‚

```js
var a = 1

function foo() {
  var b = 2
  console.log(a + b)
}

function bar() {
  var b = 3
  console.log(a + b)
}

foo() // è¾“å‡º3
bar() // è¾“å‡º4
```

### ä½œç”¨åŸŸé“¾

å½“ JavaScript ä»£ç æ‰§è¡Œæ—¶ï¼Œå®ƒä¼šå…ˆåœ¨å½“å‰ä½œç”¨åŸŸä¸­æŸ¥æ‰¾å˜é‡å’Œå‡½æ•°ã€‚å¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™ä¼šå‘ä¸Šä¸€çº§ä½œç”¨åŸŸç»§ç»­æŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°ä¸ºæ­¢ã€‚è¿™ç§æŸ¥æ‰¾æ–¹å¼è¢«ç§°ä¸ºä½œç”¨åŸŸé“¾ã€‚

## å˜é‡æå‡

### å‡½æ•°ä¸å˜é‡

```js
var a = 1
function a() {}
console.log(a)

// æå‡åçš„æ•ˆæœå¦‚ä¸‹ï¼ˆä¼ªä»£ç ï¼‰ï¼š
// var a è¢«å‡½æ•°è¦†ç›–
function a() {}
a = 1 // é‡æ–°èµ‹å€¼
console.log(a) // 1
```

```js
console.log(a)
var a = 1
function a() {}

// æå‡åçš„æ•ˆæœ
// var a è¢«å‡½æ•°è¦†ç›–
function a() {}
console.log(a) // æ‰“å°å‡½æ•°
a = 1
```

### åŸç†

Promise æ˜¯ JavaScript ä¸­ä¸€ç§**å¤„ç†å¼‚æ­¥æ“ä½œçš„æ–¹å¼ï¼Œå®ƒçš„åŸç†æ˜¯åŸºäºå¼‚æ­¥æ“ä½œçš„çŠ¶æ€æœº**åŒ…å«ä¸‰ç§çŠ¶æ€ï¼špendingï¼ˆç­‰å¾…ä¸­ï¼‰ã€fulfilledï¼ˆå·²æˆåŠŸï¼‰ã€rejectedï¼ˆå·²å¤±è´¥ï¼‰ã€‚

å½“ Promise å¯¹è±¡çš„çŠ¶æ€æ”¹å˜æ—¶ï¼Œä¼šè§¦å‘ç›¸åº”çš„å›è°ƒå‡½æ•°ã€‚

## SDK

### sdk éªŒç­¾

ç­¾åï¼Œå…¶å®ä¸€èˆ¬éƒ½æ˜¯é€šè¿‡ä¸€äº›ç®—æ³•ï¼Œç”Ÿæˆçš„ä¿¡æ¯æ‘˜è¦ï¼Œç„¶åå†åŠ å¯†å¾—åˆ°ã€‚

1. è·å–éœ€è¦éªŒç­¾çš„æ•°æ®å’Œç­¾åï¼ˆé€šå¸¸æ˜¯å­—ç¬¦ä¸²æˆ–è€…äºŒè¿›åˆ¶æ•°æ®ï¼‰ã€‚
2. è·å–å…¬é’¥ï¼ˆä¹Ÿå¯ä»¥æ˜¯è¯ä¹¦æˆ–è€…å¯†é’¥å¯¹ï¼‰ï¼Œé€šå¸¸æ˜¯ä»æœåŠ¡å™¨è·å–ã€‚
3. å°†å…¬é’¥è½¬æ¢ä¸ºå¯ä»¥è¢« js ä½¿ç”¨çš„æ ¼å¼ï¼Œé€šå¸¸æ˜¯å°†å…¬é’¥è½¬æ¢ä¸º PEM æ ¼å¼æˆ–è€… DER æ ¼å¼ã€‚
4. ä½¿ç”¨ js çš„åŠ å¯†åº“ï¼ˆå¦‚ CryptoJSï¼‰å°†æ•°æ®è¿›è¡Œå“ˆå¸Œæˆ–è€…åŠ å¯†æ“ä½œï¼Œå¾—åˆ°ä¸€ä¸ªå“ˆå¸Œå€¼æˆ–è€…åŠ å¯†åçš„æ•°æ®ã€‚
5. å°†å“ˆå¸Œå€¼æˆ–è€…åŠ å¯†åçš„æ•°æ®ä¸ç­¾åè¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœä¸€è‡´ï¼Œåˆ™éªŒç­¾é€šè¿‡ï¼Œå¦åˆ™éªŒç­¾å¤±è´¥ã€‚
6. å¯¹äºæŸäº›ç‰¹æ®Šçš„éªŒç­¾ç®—æ³•ï¼Œå¯èƒ½è¿˜éœ€è¦å¯¹ç­¾åè¿›è¡Œè§£å¯†æˆ–è€…è§£å‹ç¼©æ“ä½œï¼Œä»¥å¾—åˆ°åŸå§‹çš„å“ˆå¸Œå€¼æˆ–è€…æ•°æ®ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ JS ä¸­è¿›è¡ŒéªŒç­¾æ“ä½œéœ€è¦ä¿è¯æ•°æ®çš„å®‰å…¨æ€§ï¼Œé¿å…æ•°æ®æ³„éœ²æˆ–è€…è¢«ç¯¡æ”¹ã€‚å› æ­¤ï¼Œå»ºè®®ä½¿ç”¨ HTTPS åè®®ä¼ è¾“æ•°æ®ï¼Œä½¿ç”¨ SSL/TLS ç­‰å®‰å…¨åè®®ä¿æŠ¤æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­çš„å®‰å…¨æ€§ã€‚åŒæ—¶ï¼Œä¹Ÿéœ€è¦ä¿è¯æœåŠ¡å™¨æä¾›çš„å…¬é’¥æ˜¯å¯ä¿¡çš„ï¼Œé¿å…è¢«æ¶æ„ç¯¡æ”¹ã€‚

### å…¬é’¥è½¬æ¢

å°†å…¬é’¥è½¬æ¢ä¸º JS å¯ä½¿ç”¨çš„æ ¼å¼éœ€è¦å°†å…¬é’¥è¿›è¡Œç¼–ç ã€‚å¸¸ç”¨çš„ç¼–ç æ ¼å¼æœ‰ DER å’Œ PEM ã€‚ä»¥ä¸‹æ˜¯å°† DER ç¼–ç çš„å…¬é’¥è½¬æ¢ä¸º JS å¯ä½¿ç”¨çš„æ ¼å¼çš„æ­¥éª¤ï¼š

1. å°† DER ç¼–ç çš„å…¬é’¥è½¬æ¢ä¸º Uint8Array ç±»å‹ã€‚
2. å°† Uint8Array ç±»å‹çš„å…¬é’¥è¿›è¡Œ Base64 ç¼–ç ã€‚
3. æ„é€  JS å¯ä½¿ç”¨çš„å…¬é’¥æ ¼å¼ï¼Œä¾‹å¦‚ï¼š

```js
const publicKey = '-----BEGIN PUBLIC KEY-----\n' + base64PublicKey + '\n-----END PUBLIC KEY-----'
```

å…¶ä¸­ï¼Œ**base64PublicKey å³ä¸ºç¬¬ 2 æ­¥ä¸­å¾—åˆ°çš„ Base64 ç¼–ç ï¼Œæ³¨æ„ï¼Œä¸Šå›¾ä¸å°±æ˜¯æˆ‘ä»¬å¸¸è§çš„å…¬é’¥å½¢å¼å—**ã€‚

4. å°†å…¬é’¥å­—ç¬¦ä¸²ä¼ å…¥ JS åŠ å¯†åº“ä¸­ä½¿ç”¨ã€‚

æ³¨æ„ï¼šå¦‚æœå…¬é’¥å·²ç»æ˜¯ PEM æ ¼å¼çš„ï¼Œåˆ™æ— éœ€è¿›è¡Œè½¬æ¢ï¼Œç›´æ¥ä½¿ç”¨å³å¯ã€‚

### DER å’Œ PEM

DER (Distinguished Encoding Rules) å’Œ PEM (Privacy-Enhanced Mail) æ˜¯ä¸¤ç§å¸¸è§çš„ç¼–ç æ ¼å¼ã€‚

DER æ˜¯ä¸€ç§äºŒè¿›åˆ¶æ ¼å¼ï¼Œç”¨äºè¡¨ç¤º X.509 æ•°å­—è¯ä¹¦ã€å…¬é’¥ã€ç§é’¥å’Œå…¶ä»–è¯ä¹¦ç›¸å…³çš„æ•°æ®ã€‚å®ƒæ˜¯ä¸€ç§è¾ƒä¸ºç´§å‡‘çš„ç¼–ç æ ¼å¼ï¼Œé€‚ç”¨äºç½‘ç»œä¼ è¾“å’Œå­˜å‚¨ã€‚DER ç¼–ç ä¸åŒ…æ‹¬ä»»ä½•å¤´éƒ¨æˆ–å°¾éƒ¨ä¿¡æ¯ï¼Œå› æ­¤å®ƒçš„å¤§å°æ¯” PEM æ ¼å¼å°ã€‚

PEM æ˜¯ä¸€ç§åŸºäº ASCII ç çš„ç¼–ç æ ¼å¼ï¼Œå¸¸ç”¨äºè¡¨ç¤ºè¯ä¹¦ã€å…¬é’¥ã€ç§é’¥å’Œå…¶ä»–æ•°æ®ã€‚PEM æ ¼å¼ä½¿ç”¨ -----BEGIN å’Œ -----END å¼€å¤´å’Œç»“å°¾çš„æ ‡è®°æ¥æ ‡è¯†æ•°æ®ç±»å‹ï¼Œä»¥åŠ BASE64 ç¼–ç æ¥è¡¨ç¤ºæ•°æ®ã€‚PEM ç¼–ç å¯ä»¥åŒ…å«å¤šä¸ªæ•°æ®å—ï¼Œæ¯ä¸ªæ•°æ®å—å¯ä»¥åŒ…å«å¤šä¸ªè¡Œï¼Œæ¯è¡Œçš„é•¿åº¦é€šå¸¸ä¸è¶…è¿‡ 64 ä¸ªå­—ç¬¦ã€‚

æ‰‹åŠ¨å®ç°ä¸€ä¸ª DER å’Œ PEM å…¬é’¥çš„ç›¸äº’è½¬åŒ–

```js
// å…¬é’¥ã€åŸæ ¼å¼å’Œç›®æ ‡æ ¼å¼ã€‚
// å…¬é’¥åº”è¯¥æ˜¯ä¸€ä¸ªBufferå¯¹è±¡ï¼ŒåŸæ ¼å¼å’Œç›®æ ‡æ ¼å¼å¯ä»¥æ˜¯"DER"æˆ–"PEM"
function convertPublicKey(publicKey, fromFormat, toFormat) {
  // å°†DERæ ¼å¼çš„å…¬é’¥è½¬æ¢ä¸ºPEMæ ¼å¼
  if (fromFormat === 'DER' && toFormat === 'PEM') {
    const base64DERKey = publicKey.toString('base64')
    const pemKey = `-----BEGIN PUBLIC KEY-----\n${base64DERKey.replace(
      /(.{64})/g,
      '$1\n'
    )}\n-----END PUBLIC KEY-----\n`
    return pemKey
  }

  // å°†PEMæ ¼å¼çš„å…¬é’¥è½¬æ¢ä¸ºDERæ ¼å¼
  if (fromFormat === 'PEM' && toFormat === 'DER') {
    const base64PEMKey = publicKey
      .toString()
      .split('\n')
      .filter((line) => !line.includes('BEGIN') && !line.includes('END'))
      .join('')
    const derKey = Buffer.from(base64PEMKey, 'base64')
    return derKey
  }

  // å¦‚æœæ ¼å¼ä¸åŒ¹é…ï¼Œè¿”å›null
  return null
}
```

**æ³¨æ„ï¼š**ä¸Šé¢çš„ toString æ–¹æ³•ï¼Œå¯ä»¥ä¼ å…¥ 'base64' å…¥å‚ã€‚ã€‚ã€‚è¿™ä¸ª toString å’Œå­—ç¬¦ä¸²è½¬æ¢çš„é‚£ä¸ªä¸ä¸€æ ·ã€‚ã€‚ã€‚è¿™æ˜¯ Buffer å¯¹è±¡ä¸Šçš„æ–¹æ³•

Buffer å¯¹è±¡çš„ toString æ–¹æ³•ç”¨äºå°† Buffer å¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚

è¯¥æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼šencoding å’Œ startã€‚

- encoding å‚æ•°æŒ‡å®šäº†å­—ç¬¦ä¸²çš„ç¼–ç æ ¼å¼ï¼Œé»˜è®¤ä¸º utf8ã€‚
- start å‚æ•°æŒ‡å®šäº†ä»å“ªä¸ªä½ç½®å¼€å§‹è½¬æ¢ï¼Œé»˜è®¤ä¸º 0ã€‚

```js
const buf = Buffer.from('hello world', 'utf8')
const str = buf.toString()
console.log(str) // è¾“å‡ºï¼šhello world

const str = buf.toString('base64', 2)
console.log(str) // è¾“å‡ºï¼šbGVsbG8gd29ybGQ=
```

## ç¼–ç¨‹èŒƒå¼

### å‡½æ•°æŸ¯ç†åŒ–

å‡½æ•°æŸ¯é‡ŒåŒ–æ˜¯ä¸€ç§å°†ä¸€ä¸ªæ¥å—å¤šä¸ªå‚æ•°çš„å‡½æ•°è½¬å˜ä¸ºä¸€ç³»åˆ—åªæ¥å—å•ä¸€å‚æ•°çš„å‡½æ•°çš„æŠ€æœ¯ã€‚

å…¶åŸç†æ˜¯å°†ä¸€ä¸ªæ¥æ”¶å¤šä¸ªå‚æ•°çš„å‡½æ•°è½¬åŒ–ä¸ºä¸€ä¸ªåªæ¥æ”¶ä¸€ä¸ªå‚æ•°çš„å‡½æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œæ–°çš„å‡½æ•°æ¥æ”¶å‰©ä½™çš„å‚æ•°ï¼Œæœ€ç»ˆè¿”å›ç»“æœã€‚

åº•å±‚å®ç°å¯ä»¥é‡‡ç”¨é—­åŒ…å’Œé€’å½’çš„æ–¹å¼å®ç°ã€‚å…·ä½“å®ç°å¦‚ä¸‹ï¼š

```js
// å…¥å‚æ˜¯åŸå§‹å‡½æ•°
function curry(fn) {
  return function curried(...args) {
    // å¦‚æœæ–°å‡½æ•°çš„å…¥å‚æ•°é‡è¾¾åˆ°åŸå§‹å‡½æ•°çš„é•¿åº¦ï¼Œåˆ™ç›´æ¥æ‰§è¡Œ
    // fn.length æ˜¯å½¢å‚çš„ä¸ªæ•°
    if (args.length >= fn.length) {
      return fn.apply(this, args)
    } else {
      // å¦åˆ™ï¼Œç»§ç»­è¿”å›å‡½æ•°ï¼Œå¹¶æ‹¼æ¥å‚æ•°
      return function (...arg1) {
        return curried.apply(this, args.concat(arg1))
      }
    }
  }
}
```

è¿™é‡Œä½¿ç”¨äº†é—­åŒ…ï¼Œå°†åŸå§‹å‡½æ•° fn ä¿å­˜åœ¨å¤–éƒ¨å‡½æ•° curry çš„ä½œç”¨åŸŸä¸­ã€‚

å½“è°ƒç”¨ curry å‡½æ•°æ—¶ï¼Œè¿”å›ä¸€ä¸ªå†…éƒ¨å‡½æ•° curriedï¼Œè¯¥å‡½æ•°æ¥æ”¶ä¸€ä¸ªå‚æ•°...argsï¼Œå¦‚æœå‚æ•°ä¸ªæ•°å¤§äºç­‰äºåŸå§‹å‡½æ•° fn çš„å‚æ•°ä¸ªæ•°ï¼Œåˆ™ç›´æ¥è°ƒç”¨åŸå§‹å‡½æ•° fn å¹¶è¿”å›ç»“æœï¼Œ

å¦åˆ™è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥æ”¶å‰©ä½™çš„å‚æ•°...args2ï¼Œå¹¶å°† args å’Œ args2 åˆå¹¶åé€’å½’è°ƒç”¨ curried å‡½æ•°ï¼Œç›´åˆ°å‚æ•°ä¸ªæ•°è¶³å¤Ÿè°ƒç”¨åŸå§‹å‡½æ•° fnã€‚

```js
// æ±‚å’Œ
function add(a, b, c) {
  return a + b + c;
}

const curriedAdd = curry(add);

console.log(curriedAdd(1)(2)(3)); // 6
console.log(curriedAdd(1, 2)(3)); // 6
console.log(curriedAdd(1)(2, 3)); // 6
console.log(curriedAdd(1, 2, 3)); // 6

// é—®å€™
function greet(greeting, name) {
  return ${greeting}, ${name}!;
}

const curriedGreet = curry(greet);

console.log(curriedGreet('Hello')('John')); // Hello, John!
console.log(curriedGreet('Hi', 'Mary')); // Hi, Mary!
```

#### æŸ¯ç†åŒ–äº§ç”Ÿçš„åŸå› 

æŸ¯é‡ŒåŒ–çš„äº§ç”Ÿæºäºå‡½æ•°å¼ç¼–ç¨‹çš„æ€æƒ³ï¼Œå®ƒæ˜¯**ä¸€ç§å°†å¤šä¸ªå‚æ•°çš„å‡½æ•°è½¬æ¢ä¸ºä¸€ç³»åˆ—åªæ¥å—ä¸€ä¸ªå‚æ•°çš„å‡½æ•°çš„æŠ€æœ¯**ã€‚**æŸ¯é‡ŒåŒ–çš„ä¸»è¦ç›®çš„æ˜¯ç®€åŒ–å‡½æ•°çš„è°ƒç”¨æ–¹å¼å’Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚**

åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­ï¼Œå‡½æ•°è¢«è§†ä¸ºä¸€ç­‰å…¬æ°‘ï¼Œå®ƒä»¬å¯ä»¥åƒå…¶ä»–æ•°æ®ç±»å‹ä¸€æ ·è¢«ä¼ é€’å’Œæ“ä½œã€‚å› æ­¤ï¼Œå°†ä¸€ä¸ªå¤šå‚æ•°çš„å‡½æ•°è½¬æ¢ä¸ºä¸€ç³»åˆ—åªæ¥å—ä¸€ä¸ªå‚æ•°çš„å‡½æ•°ï¼Œå¯ä»¥æ›´æ–¹ä¾¿åœ°å°†å‡½æ•°ä¼ é€’ç»™å…¶ä»–å‡½æ•°æˆ–è€…ç»„åˆå‡½æ•°ã€‚æ­¤å¤–ï¼ŒæŸ¯é‡ŒåŒ–è¿˜å¯ä»¥é™ä½å‡½æ•°çš„è€¦åˆåº¦ï¼Œä½¿å¾—ä»£ç æ›´æ˜“äºæµ‹è¯•å’Œé‡æ„ã€‚

å› æ­¤ï¼ŒæŸ¯é‡ŒåŒ–æ˜¯å‡½æ•°å¼ç¼–ç¨‹ä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨å‡½æ•°å¼ç¼–ç¨‹çš„æ€æƒ³ã€‚

æŸ¯é‡ŒåŒ–çš„ä¸»è¦ç›®çš„æ˜¯ç®€åŒ–å‡½æ•°çš„è°ƒç”¨æ–¹å¼å’Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªä»£ç ç¤ºä¾‹ï¼Œæ¼”ç¤ºè¿™ç§ç®€åŒ–æ•ˆæœï¼Ÿ

å‡è®¾æœ‰ä¸€ä¸ªå‡½æ•° addï¼Œç”¨äºè®¡ç®—ä¸¤ä¸ªæ•°å­—çš„å’Œï¼š

```js
function add(x, y) {
  return x + y
}
```

é€šè¿‡æŸ¯é‡ŒåŒ–ï¼Œå¯ä»¥å°†è¿™ä¸ªå‡½æ•°è½¬æ¢ä¸ºæ¥å—ä¸€ä¸ªå‚æ•°çš„å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥å—ç¬¬äºŒä¸ªå‚æ•°å¹¶è¿”å›ç»“æœã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ›´ç®€å•çš„æ–¹å¼è°ƒç”¨ add å‡½æ•°ï¼š

```js
function add(x) {
  return function (y) {
    return x + y
  }
}

// è°ƒç”¨æ–¹å¼
add(2)(3) // 5
```

è¿™ç§æ–¹å¼å°†å‡½æ•°è°ƒç”¨æ‹†åˆ†ä¸ºå¤šä¸ªæ­¥éª¤ï¼Œä½¿ä»£ç æ›´æ˜“è¯»å’Œç»´æŠ¤ã€‚æ­¤å¤–ï¼Œè¿™ç§æ–¹å¼è¿˜å…è®¸æˆ‘ä»¬éƒ¨åˆ†åº”ç”¨å‡½æ•°ï¼Œå³é¢„å…ˆè®¾ç½®ä¸€äº›å‚æ•°å¹¶è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œä»¥ä¾¿ç¨åè°ƒç”¨ã€‚ä¾‹å¦‚ï¼š

```js
const addTwo = add(2)
addTwo(3) // 5
addTwo(4) // 6
```

### AOPï¼ˆAspect-Oriented Programmingï¼‰

AOPï¼ˆAspect-Oriented Programmingï¼‰ç¼–ç¨‹æ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œå®ƒå¯ä»¥åœ¨ä¸ä¿®æ”¹åŸæœ‰ä»£ç çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡åˆ‡é¢ï¼ˆAspectï¼‰çš„æ–¹å¼æ¥å¢å¼ºç¨‹åºçš„åŠŸèƒ½ã€‚

AOP çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†ç¨‹åºçš„å…³æ³¨ç‚¹ï¼ˆConcernï¼‰åˆ†ç¦»å‡ºæ¥ï¼Œé€šè¿‡åˆ‡é¢æ¥å®ç°è¿™äº›å…³æ³¨ç‚¹çš„åŠŸèƒ½ï¼Œä»è€Œå®ç°ä»£ç çš„è§£è€¦å’Œå¤ç”¨ã€‚

åœ¨ JavaScript ä¸­ï¼ŒAOP ç¼–ç¨‹é€šå¸¸é€šè¿‡æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰æˆ–è€…è£…é¥°å™¨ï¼ˆDecoratorï¼‰æ¥å®ç°ã€‚

æ‹¦æˆªå™¨æ˜¯ä¸€ç§èƒ½å¤Ÿåœ¨å‡½æ•°æ‰§è¡Œå‰ã€æ‰§è¡Œåæˆ–è€…æŠ›å‡ºå¼‚å¸¸æ—¶æ‹¦æˆªå‡½æ•°è°ƒç”¨çš„æœºåˆ¶ï¼Œé€šè¿‡æ‹¦æˆªå™¨å¯ä»¥å®ç°æ—¥å¿—è®°å½•ã€æ€§èƒ½ç»Ÿè®¡ã€å®‰å…¨æ£€æŸ¥ç­‰åŠŸèƒ½ã€‚è£…é¥°å™¨åˆ™æ˜¯ä¸€ç§èƒ½å¤Ÿåœ¨å‡½æ•°æˆ–è€…ç±»ä¸Šæ·»åŠ é¢å¤–åŠŸèƒ½çš„æœºåˆ¶ï¼Œé€šè¿‡è£…é¥°å™¨å¯ä»¥å®ç°ç¼“å­˜ã€æƒé™æ§åˆ¶ã€é”™è¯¯å¤„ç†ç­‰åŠŸèƒ½ã€‚

AOP ç¼–ç¨‹åœ¨ JavaScript ä¸­çš„åº”ç”¨éå¸¸å¹¿æ³›ï¼Œæ¯”å¦‚åœ¨ React ä¸­ä½¿ç”¨è£…é¥°å™¨æ¥å®ç°é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰ã€åœ¨ Node.js ä¸­ä½¿ç”¨æ‹¦æˆªå™¨æ¥å®ç°ä¸­é—´ä»¶ç­‰ã€‚

> AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰æ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œä¸å‡½æ•°å¼ç¼–ç¨‹ä¸åŒã€‚AOP æ˜¯ä¸€ç§é€šè¿‡å°†æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆå¦‚æ—¥å¿—è®°å½•å’Œäº‹åŠ¡ç®¡ç†ï¼‰ä»ä¸»ä¸šåŠ¡é€»è¾‘ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç®¡ç†å’Œç»´æŠ¤ä»£ç çš„æŠ€æœ¯ã€‚AOP ä½¿ç”¨ç‰¹å®šçš„æŠ€æœ¯å’Œå·¥å…·ï¼Œå¦‚åˆ‡é¢ã€è¿æ¥ç‚¹ã€é€šçŸ¥å’Œåˆ‡ç‚¹ç­‰ï¼Œæ¥å®ç°è¿™ç§åˆ†ç¦»ã€‚è™½ç„¶ AOP å’Œå‡½æ•°å¼ç¼–ç¨‹éƒ½ä¸é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸åŒï¼Œä½†å®ƒä»¬åˆå„è‡ªæœ‰ä¸åŒçš„ç‰¹ç‚¹å’Œåº”ç”¨åœºæ™¯ã€‚

å®ç° AOP ç¼–ç¨‹çš„å‡ ç§æ–¹å¼ï¼š

- ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼ï¼šåœ¨å‡½æ•°æˆ–æ–¹æ³•æ‰§è¡Œå‰åæ·»åŠ é¢å¤–çš„é€»è¾‘ã€‚å¯ä»¥ä½¿ç”¨ ES6 ä¸­çš„è£…é¥°å™¨è¯­æ³•æ¥å®ç°ã€‚
- ä½¿ç”¨å‡½æ•°æŸ¯é‡ŒåŒ–ï¼šå°†åŸå‡½æ•°æ‹†åˆ†ä¸ºå¤šä¸ªå°å‡½æ•°ï¼Œæ¯ä¸ªå°å‡½æ•°æ‰§è¡Œä¸€ä¸ªç‰¹å®šçš„é€»è¾‘ï¼Œç„¶åå†å°†è¿™äº›å°å‡½æ•°ç»„åˆèµ·æ¥ã€‚
- ä½¿ç”¨ä»£ç†æ¨¡å¼ï¼šé€šè¿‡ä»£ç†å¯¹è±¡æ¥åŒ…è£…åŸå¯¹è±¡ï¼Œä»è€Œåœ¨æ–¹æ³•æ‰§è¡Œå‰åæ·»åŠ é¢å¤–çš„é€»è¾‘ã€‚å¯ä»¥ä½¿ç”¨ ES6 ä¸­çš„ Proxy å¯¹è±¡æ¥å®ç°ã€‚
- ä½¿ç”¨åˆ‡é¢ç¼–ç¨‹æ¡†æ¶ï¼šå¦‚ Aspect.jsï¼Œå®ƒæ˜¯ä¸€ä¸ªåŸºäº JavaScript çš„åˆ‡é¢ç¼–ç¨‹æ¡†æ¶ï¼Œå¯ä»¥é€šè¿‡æ·»åŠ æ³¨è§£æ¥å®ç° AOPã€‚

#### ä½¿ç”¨è£…é¥°å™¨ï¼š

```js
function log(target, name, descriptor) {
  const original = descriptor.value

  descriptor.value = function (...args) {
    console.log(`Calling function ${name} with arguments: ${args}`)
    const result = original.apply(this, args)
    console.log(`Function ${name} returned: ${result}`)
    return result
  }
  return descriptor
}

class Calculator {
  @log
  add(a, b) {
    return a + b
  }
}

const calculator = new Calculator()
console.log(calculator.add(2, 3)) // Calling function add with arguments: 2,3
// Function add returned: 5
// 5
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸º log çš„è£…é¥°å™¨å‡½æ•°ï¼Œå®ƒæ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼šç›®æ ‡å¯¹è±¡ã€ç›®æ ‡å‡½æ•°çš„åç§°å’Œæè¿°ç¬¦å¯¹è±¡ã€‚æˆ‘ä»¬ä½¿ç”¨ descriptor.value æ¥è·å–åŸå§‹å‡½æ•°ï¼Œå¹¶å°†å…¶æ›¿æ¢ä¸ºä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°åœ¨è°ƒç”¨åŸå§‹å‡½æ•°ä¹‹å‰å’Œä¹‹åè¾“å‡ºæ—¥å¿—ã€‚æœ€åï¼Œæˆ‘ä»¬è¿”å›ä¿®æ”¹åçš„æè¿°ç¬¦å¯¹è±¡ã€‚

ç„¶åï¼Œæˆ‘ä»¬åœ¨ Calculator ç±»çš„ add æ–¹æ³•ä¸Šåº”ç”¨äº†@log è£…é¥°å™¨ã€‚å½“æˆ‘ä»¬è°ƒç”¨ add æ–¹æ³•æ—¶ï¼Œä¼šè‡ªåŠ¨æ‰“å°æ—¥å¿—ã€‚

#### ä½¿ç”¨ Proxy ä»£ç†

```js
function withLog(fn) {
  return new Proxy(fn, {
    apply(target, thisArg, args) {
      console.log(`[${fn.name}] start`)
      const start = performance.now()
      const result = target.apply(thisArg, args)
      const end = performance.now()
      console.log(`[${fn.name}] end, time: ${end - start}ms`)
      return result
    },
  })
}

class MyClass {
  myMethod() {
    // do something
  }
}

const myObj = new MyClass()
myObj.myMethod = withLog(myObj.myMethod)
```

#### å‡½æ•°æŸ¯ç†åŒ–å®ç°

åˆ©ç”¨å‡½æ•°æŸ¯é‡ŒåŒ–ï¼Œæˆ‘ä»¬å¯ä»¥å°† AOP é€»è¾‘å°è£…æˆä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªæ–°å‡½æ•°ï¼Œç”¨äºæ‰§è¡ŒåŸå‡½æ•°å¹¶æ·»åŠ  AOP é€»è¾‘ã€‚

```js
function withLog(fn) {
  return function (...args) {
    console.log(`[${fn.name}] start`)
    const start = performance.now()
    const result = fn.apply(this, args)
    const end = performance.now()
    console.log(`[${fn.name}] end, time: ${end - start}ms`)
    return result
  }
}

class MyClass {
  myMethod() {
    // do something
  }
}

const myObj = new MyClass()
myObj.myMethod = withLog(myObj.myMethod)
```

## å‡½æ•°

### ç®­å¤´å‡½æ•°

```js
// 1ã€ç®­å¤´å‡½æ•°æ²¡æœ‰prototype(åŸå‹)ï¼Œæ‰€ä»¥ç®­å¤´å‡½æ•°æœ¬èº«æ²¡æœ‰this
let a = () => {};
a.prototype; // undefined

// 2ã€ç®­å¤´å‡½æ•°çš„thisæŒ‡å‘åœ¨å®šä¹‰çš„æ—¶å€™ç»§æ‰¿è‡ªå¤–å±‚ç¬¬ä¸€ä¸ªæ™®é€šå‡½æ•°çš„thisã€‚
var a;
var barObj = { msg: 'barObj' };
var fooObj = { msg: 'fooObj' };

function foo() { a() }
function bar() {
  a = () => console.log(this.msg)
}

bar.call(barObj); // barObj å…ˆæ‰§è¡Œï¼Œå®šä¹‰ç®­å¤´å‡½æ•° aï¼Œæ­¤æ—¶ a å°±ç»‘å®šåˆ° barObj äº†

foo.call(fooObj); // barObj ç„¶åå†æ‰§è¡Œfooï¼Œå³ä½¿æƒ³å†æ¬¡ç»‘å®šthisï¼Œä½†æ˜¯ a çš„æŒ‡å‘å·²ç»ä¸å˜äº†ï¼Œè¿™é‡Œåªæ˜¯æ‰§è¡Œè€Œå·²

// ğŸ”¥ è¢«ç»§æ‰¿çš„æ™®é€šå‡½æ•°çš„thisæŒ‡å‘æ”¹å˜ï¼Œç®­å¤´å‡½æ•°çš„thisæŒ‡å‘ä¼šè·Ÿç€æ”¹å˜(å› æ­¤æƒ³ä¿®æ”¹ç®­å¤´å‡½æ•°çš„thisæŒ‡å‘ï¼Œå¯ä»¥ä¿®æ”¹å¤–å±‚)
// ğŸ”¥ ç®­å¤´å‡½æ•°çš„thisæŒ‡å‘å®šä¹‰æ—¶æ‰€åœ¨çš„å¤–å±‚ç¬¬ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œè·Ÿä½¿ç”¨ä½ç½®æ²¡æœ‰å…³ç³»ã€‚

// 3ã€ç›´æ¥ä¿®æ”¹ç®­å¤´å‡½æ•°çš„thisæŒ‡å‘æ— æ•ˆ
let fnObj = { msg: 'å°è¯•ç›´æ¥ä¿®æ”¹ç®­å¤´å‡½æ•°çš„thisæŒ‡å‘' };
function foo() {
  a.call(fnObj); // åˆ©ç”¨callç›´æ¥ä¿®æ”¹ï¼Œæ— æ•ˆ
}
foo(); // ä¾ç„¶æ˜¯ barObj


// 4ã€ç®­å¤´å‡½æ•°å¤–å±‚æ²¡æœ‰æ™®é€šå‡½æ•°ï¼Œä¸¥æ ¼æ¨¡å¼å’Œéä¸¥æ ¼æ¨¡å¼ä¸‹å®ƒçš„thiséƒ½ä¼šæŒ‡å‘window(å…¨å±€å¯¹è±¡)
var arrowFn1 = () => {
  // 'use strict'
  console.log(this);
}
arrowFn1(); // window


// ä½†éœ€è¦æ™®é€šå‡½æ•°åœ¨æ˜¯å¦ä¸¥æ ¼æ¨¡å¼ä¸‹çš„thisæŒ‡å‘
function foo() {
  "use strict";
  // æ­¤æ—¶å‡½æ•°ä½“å¤„äºä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œä¼šè¢«ç»‘å®šåˆ°undefined
  console.log(this.a);
}
var a = 2;
foo();      // TypeError: Cannot read property 'a' of undefined


// 5ã€ç®­å¤´å‡½æ•°çš„arguments
// 5-1ã€å¦‚æœç®­å¤´å‡½æ•°çš„thisæŒ‡å‘window(å…¨å±€å¯¹è±¡)ä½¿ç”¨argumentsä¼šæŠ¥é”™ï¼Œæœªå£°æ˜argumentsã€‚
let b = () => {
  console.log(arguments);
};
b(1, 2, 3, 4); // Uncaught ReferenceError: arguments is not defined


// 5-2ã€å¦‚æœç®­å¤´å‡½æ•°çš„thisæŒ‡å‘æ™®é€šå‡½æ•°æ—¶,å®ƒçš„argumensç»§æ‰¿äºè¯¥æ™®é€šå‡½æ•°ã€‚
function bar() {
  console.log(arguments); // 1

  bb(1.1);
  function bb() {
    console.log(arguments);            // 1.1
    let a = () => {
      console.log(arguments, 'arrow'); // 1.1 arrow
    };
    a(2); // è¿™é‡Œä¼ å…¥çš„å‚æ•°æ— æ•ˆï¼Œå› ä¸ºargumentsç»§æ‰¿äºå¤–å±‚çš„æ™®é€šå‡½æ•°
  }
}
bar(1);

// 6ã€ä½¿ç”¨newè°ƒç”¨ç®­å¤´å‡½æ•°ä¼šæŠ¥é”™
let Foo = () => {};
let b = new Foo();   // Foo is not a constructor

// 7ã€ç®­å¤´å‡½æ•°ä¸æ”¯æŒnew.target
// es6å¼•å…¥æ–°å±æ€§ï¼Œnew.targetå±æ€§ï¼Œæ™®é€šå‡½æ•°å¦‚æœé€šè¿‡newè°ƒç”¨ï¼Œnew.targetä¼šè¿”å›è¯¥å‡½æ•°çš„å¼•ç”¨ã€‚
function Foo() {
  console.log(new.target)
}
new Foo();  // FooÂ {}

let Bar = () => {
  console.log(new.target); // new.target expression is not allowed here
}
Bar();

// 7-1ã€ç®­å¤´å‡½æ•°çš„thisæŒ‡å‘æ™®é€šå‡½æ•°ï¼Œå®ƒçš„new.targetå°±æ˜¯æŒ‡å‘è¯¥æ™®é€šå‡½æ•°çš„å¼•ç”¨ã€‚
new Bar();
function Bar() {
  let a = () => {
    console.log(new.target); // BarÂ {}
  };
  a();
}

// 8ã€ç®­å¤´å‡½æ•°ä¸æ”¯æŒé‡å¤åå­—çš„å‡½æ•°å‚æ•°
function func1(a, a) {
  console.log(a, arguments); // 2 [1,2]
}
func1(1, 2);

var func2 = (a,a) => {
  console.log(a);      // Duplicate parameter name not allowed in this context
};
func2(1, 2);
```

é¡¹ç›®ä¸­ç»å¸¸æœ‰ä¸‹é¢çš„å†™æ³•ï¼š

```js
const obj = {
  array: [1, 2, 3],
  sum: () => {
    // å¤–å±‚æ²¡æœ‰æ™®é€šå‡½æ•°thisä¼šæŒ‡å‘å…¨å±€å¯¹è±¡
    return this.array.push('å…¨å±€å¯¹è±¡ä¸‹æ²¡æœ‰arrayï¼Œè¿™é‡Œä¼šæŠ¥é”™') // æ‰¾ä¸åˆ°pushæ–¹æ³•
  },
}
obj.sum()

// åªéœ€
const obj = {
  array: [1, 2, 3],
  sum() {
    return this.array.push('å…¨å±€å¯¹è±¡ä¸‹æ²¡æœ‰arrayï¼Œè¿™é‡Œä¼šok')
  },
}
obj.sum() // æ™®é€šå‡½æ•°ä¸­çš„thisæŒ‡å‘è°ƒç”¨è¯¥å‡½æ•°çš„å¯¹è±¡ï¼Œæ‰§è¡Œ obj.sum() åï¼Œsumå†…éƒ¨çš„ this å°±æŒ‡å‘äº† obj
```

- ç®­å¤´å‡½æ•°æ˜¯ç”± name å±æ€§çš„

## æ•°ç»„

### æ•°ç»„å»é‡

```js
// æ–¹å¼ä¸€
const arr = [1, 2, 2, 3, 3, 4, 5, 5]
const uniqueArr = [...new Set(arr)]
console.log(uniqueArr) // [1, 2, 3, 4, 5]

// æ–¹å¼äºŒ
const arr = [1, 2, 2, 3, 3, 4, 5, 5]
// åªå–ç¬¬ä¸€æ¬¡å‡ºç°çš„æ•°æ®
const uniqueArr = arr.filter((item, index, array) => array.indexOf(item) === index)
console.log(uniqueArr) // [1, 2, 3, 4, 5]

// æ–¹å¼ä¸‰
const arr = [1, 2, 2, 3, 3, 4, 5, 5]
const uniqueArr = arr.reduce((prev, curr) => (prev.includes(curr) ? prev : [...prev, curr]), [])
console.log(uniqueArr) // [1, 2, 3, 4, 5]

// æ–¹å¼å››
const arr = [1, 2, 2, 3, 3, 4, 5, 5]
const uniqueArr = []
for (let i = 0; i < arr.length; i++) {
  if (uniqueArr.indexOf(arr[i]) === -1) {
    uniqueArr.push(arr[i])
  }
}
console.log(uniqueArr) // [1, 2, 3, 4, 5]

// æ–¹å¼äº”
var uniqueArr = arr.reduce((map, item) => {
  map[item] = 0
  // ä¸èƒ½åœ¨é‡Œé¢ç›´æ¥è¿”å›Object.keys(map)
  // å› ä¸ºè¿™é‡Œè¿”å›çš„mapä¼šä¾ç„¶ä½œä¸ºä¸‹æ¬¡è¿­ä»£çš„åˆå§‹å€¼
  return map
}, {})
Object.keys(uniqueArr)

// æ‰¾åˆ°ä¸¤ä¸ªæ•°ç»„ä¸­ï¼Œé‡å¤çš„æ•°å­—
function findDuplicates(arr1, arr2) {
  // å°†æ•°ç»„è½¬æ¢ä¸º Setï¼Œå»é™¤é‡å¤å…ƒç´ 
  const set1 = new Set(arr1)
  const set2 = new Set(arr2)
  // ä½¿ç”¨ filter æ–¹æ³•è¿‡æ»¤å‡ºä¸¤ä¸ª Set éƒ½æœ‰çš„å…ƒç´ 
  const duplicates = [...set1].filter((item) => set2.has(item))
  return duplicates
}
```

## æ–‡ä»¶ä¸‹è½½

### å›¾ç‰‡ä¸‹è½½

```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Save Image to Local Album</title>
  </head>
  <body>
    <img
      src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c94f4f5c114a4bf4b5f40ae5a8d6b805~tplv-k3u1fbpfcp-zoom-1.png"
      id="image"
    />
    <button style="width: 100px; height: 50px" id="save">ç‚¹å‡»æˆ‘ï¼Œä¿å­˜å›¾ç‰‡</button>
    <script>
      var image = document.getElementById('image')
      var saveButton = document.getElementById('save')

      saveButton.addEventListener('click', function () {
        var canvas = document.createElement('canvas')
        canvas.width = image.width
        canvas.height = image.height
        var context = canvas.getContext('2d')
        context.drawImage(image, 0, 0)

        canvas.toBlob(function (blob) {
          var url = URL.createObjectURL(blob)
          var a = document.createElement('a')
          a.href = url
          a.download = 'image.jpg'
          a.click()
          URL.revokeObjectURL(url)
        })
      })
    </script>
  </body>
</html>
```

ç”±äº JavaScript çš„åŒæºç­–ç•¥ï¼Œæ— æ³•ç›´æ¥ç›‘å¬ä¸Šé¢ a æ ‡ç­¾æ–‡ä»¶çš„ä¸‹è½½å®Œæˆäº‹ä»¶ã€‚ä½†æ˜¯ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼æ¥å®ç°ç±»ä¼¼çš„æ•ˆæœï¼š

- ä½¿ç”¨ XMLHttpRequest è¯·æ±‚æ–‡ä»¶ï¼Œç›‘å¬å…¶ load äº‹ä»¶ï¼Œç„¶åä½¿ç”¨ Blob å¯¹è±¡åˆ›å»º URLï¼Œå°†å…¶èµ‹å€¼ç»™ a æ ‡ç­¾çš„ href å±æ€§ï¼Œä»è€Œå®ç°æ–‡ä»¶ä¸‹è½½ã€‚
- ä½¿ç”¨ iframe æˆ–è€… window.open æ‰“å¼€æ–‡ä»¶ä¸‹è½½é“¾æ¥ï¼Œç„¶åä½¿ç”¨å®šæ—¶å™¨è½®è¯¢åˆ¤æ–­æ–‡ä»¶æ˜¯å¦ä¸‹è½½å®Œæˆã€‚
- ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ï¼Œå¦‚ FileSaver.jsï¼Œå®ƒæä¾›äº†ä¸€äº›æ–¹æ³•å¯ä»¥ç›´æ¥å°†æ–‡ä»¶ä¿å­˜åˆ°æœ¬åœ°ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†ä¸‹è½½å®Œæˆçš„å›è°ƒå‡½æ•°ã€‚

## ç»§æ‰¿

1. åŸå‹é“¾ç»§æ‰¿ï¼šé€šè¿‡å°†å­ç±»çš„åŸå‹è®¾ç½®ä¸ºçˆ¶ç±»çš„å®ä¾‹ï¼Œå®ç°ç»§æ‰¿ã€‚ç¼ºç‚¹æ˜¯çˆ¶ç±»çš„å¼•ç”¨ç±»å‹å±æ€§ä¼šè¢«æ‰€æœ‰å­ç±»å®ä¾‹å…±äº«ã€‚
2. æ„é€ å‡½æ•°ç»§æ‰¿ï¼šé€šè¿‡åœ¨å­ç±»æ„é€ å‡½æ•°ä¸­è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°ï¼Œå®ç°ç»§æ‰¿ã€‚ç¼ºç‚¹æ˜¯çˆ¶ç±»åŸå‹ä¸Šçš„æ–¹æ³•å’Œå±æ€§æ— æ³•è¢«ç»§æ‰¿ã€‚
3. ç»„åˆç»§æ‰¿ï¼šå°†åŸå‹é“¾ç»§æ‰¿å’Œæ„é€ å‡½æ•°ç»§æ‰¿ç»“åˆèµ·æ¥ï¼Œæ—¢èƒ½ç»§æ‰¿çˆ¶ç±»åŸå‹ä¸Šçš„æ–¹æ³•å’Œå±æ€§ï¼Œåˆèƒ½é¿å…å…±äº«çˆ¶ç±»å¼•ç”¨ç±»å‹å±æ€§çš„é—®é¢˜ã€‚
4. åŸå‹å¼ç»§æ‰¿ï¼šé€šè¿‡åˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡ï¼Œå°†çˆ¶ç±»å®ä¾‹ä½œä¸ºè¯¥å¯¹è±¡çš„åŸå‹ï¼Œå®ç°ç»§æ‰¿ã€‚ç¼ºç‚¹æ˜¯æ— æ³•ä¼ é€’å‚æ•°ï¼ŒåŒæ—¶å­˜åœ¨å…±äº«çˆ¶ç±»å¼•ç”¨ç±»å‹å±æ€§çš„é—®é¢˜ã€‚
5. å¯„ç”Ÿå¼ç»§æ‰¿ï¼šä½¿ç”¨åŸå‹å¼ç»§æ‰¿ï¼Œä½†åœ¨è¿”å›æ–°å¯¹è±¡ä¹‹å‰ï¼Œé€šè¿‡æ·»åŠ æ–¹æ³•ç­‰æ“ä½œï¼Œå¢å¼ºæ–°å¯¹è±¡ã€‚ç¼ºç‚¹åŒåŸå‹å¼ç»§æ‰¿ã€‚
6. å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿ï¼šé€šè¿‡å€Ÿç”¨æ„é€ å‡½æ•°ç»§æ‰¿çˆ¶ç±»å±æ€§å’Œæ–¹æ³•ï¼Œå†é€šè¿‡å¯„ç”Ÿå¼ç»§æ‰¿çˆ¶ç±»åŸå‹ä¸Šçš„æ–¹æ³•å’Œå±æ€§ï¼Œå®ç°ç»§æ‰¿ã€‚æ˜¯ä¸€ç§æ¯”è¾ƒå®Œå–„çš„ç»§æ‰¿æ–¹å¼ã€‚

### åŸå‹é“¾ç»§æ‰¿

```javascript
function Parent() {
  this.name = 'parent'
}
Parent.prototype.sayName = function () {
  console.log(this.name)
}

function Child() {
  this.age = 18
}
Child.prototype = new Parent()

var child = new Child()
child.sayName() // parent
```

- å°†çˆ¶ç±»çš„å®ä¾‹ä½œä¸ºå­ç±»çš„åŸå‹
- ç¼ºç‚¹æ˜¯çˆ¶ç±»çš„å¼•ç”¨ç±»å‹å±æ€§ä¼šè¢«æ‰€æœ‰å­ç±»å®ä¾‹å…±äº«ã€‚

### å€Ÿç”¨æ„é€ å‡½æ•°ç»§æ‰¿

```javascript
function Parent(name) {
  this.name = name
}
Parent.prototype.sayName = function () {
  console.log(this.name)
}

function Child(name, age) {
  // åœ¨å­ç±»é‡Œï¼Œè°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°
  Parent.call(this, name)
  this.age = age
}

var child = new Child('child', 18)
console.log(child.name) // child
console.log(child.age) // 18
```

- åœ¨å­ç±»ä¸­ï¼Œç›´æ¥è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°
- ç¼ºç‚¹æ˜¯çˆ¶ç±»åŸå‹ä¸Šçš„æ–¹æ³•å’Œå±æ€§æ— æ³•è¢«ç»§æ‰¿ã€‚

### ç»„åˆç»§æ‰¿

```javascript
function Parent(name) {
  this.name = name
}
Parent.prototype.sayName = function () {
  console.log(this.name)
}

function Child(name, age) {
  Parent.call(this, name)
  this.age = age
}
Child.prototype = new Parent()
Child.prototype.constructor = Child

var child = new Child('child', 18)
child.sayName() // child
```

- çˆ¶ç±»çš„å®ä¾‹ï¼Œä½œä¸ºå­ç±»çš„åŸå‹
- åœ¨å­ç±»çš„æ„é€ å‡½æ•°é‡Œï¼Œè°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°
- æ—¢èƒ½ç»§æ‰¿çˆ¶ç±»åŸå‹ä¸Šçš„æ–¹æ³•å’Œå±æ€§ï¼Œåˆèƒ½é¿å…å…±äº«çˆ¶ç±»å¼•ç”¨ç±»å‹å±æ€§çš„é—®é¢˜ï¼Ÿï¼Ÿï¼Ÿè¿™æ˜¯æ€ä¹ˆé¿å…çš„ï¼Ÿ
  - å½“æ‰§è¡Œ new Parent() æ—¶ï¼ŒChild.prototype ä¼šå¾—åˆ° name å±æ€§
  - å½“æ‰§è¡Œ new Child('child', 18) æ—¶ï¼Œåˆä¼šè°ƒç”¨ Parent æ„é€ å‡½æ•°ï¼Œchild å®ä¾‹ä¸Šåˆå¾—åˆ°ä¸€ä¸ª name å±æ€§ï¼Œä»è€Œè¦†ç›–ä¸Šä¸€æ­¥å¾—åˆ°çš„ name å±æ€§

### åŸå‹å¼ç»§æ‰¿

```javascript
function createObj(o) {
  function F() {}
  F.prototype = o
  return new F()
}

var parent = {
  name: 'parent',
  sayName: function () {
    console.log(this.name)
  },
}

var child = createObj(parent)
child.sayName() // parent
```

- é€šè¿‡åˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡ï¼Œå°†çˆ¶ç±»å®ä¾‹ä½œä¸ºè¯¥å¯¹è±¡çš„åŸå‹ï¼Œå®ç°ç»§æ‰¿ã€‚æ¯”å¦‚ parent å°±æ˜¯çˆ¶ç±»å®ä¾‹ï¼Œç„¶ååˆ›å»ºä¸€ä¸ª F ç©ºå‡½æ•°å¯¹è±¡ï¼Œæœ€åå®ä¾‹åŒ– F å¹¶è¿”å›
- ç¼ºç‚¹æ˜¯æ— æ³•ä¼ é€’å‚æ•°ï¼ŒåŒæ—¶å­˜åœ¨å…±äº«çˆ¶ç±»å¼•ç”¨ç±»å‹å±æ€§çš„é—®é¢˜ã€‚

#### å¯„ç”Ÿå¼ç»§æ‰¿

ä½¿ç”¨åŸå‹å¼ç»§æ‰¿ï¼Œä½†åœ¨è¿”å›æ–°å¯¹è±¡ä¹‹å‰ï¼Œé€šè¿‡æ·»åŠ æ–¹æ³•ç­‰æ“ä½œï¼Œå¢å¼ºæ–°å¯¹è±¡ã€‚ç¼ºç‚¹åŒåŸå‹å¼ç»§æ‰¿ã€‚

```javascript
function createObj(o) {
  function F() {}
  F.prototype = o
  return new F()
}

function createChild(parent, age) {
  var child = createObj(parent)
  child.age = age
  return child
}

var parent = {
  name: 'parent',
  sayName: function () {
    console.log(this.name)
  },
}

var child = createChild(parent, 18)
child.sayName() // parent
```

### å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿

é€šè¿‡å€Ÿç”¨æ„é€ å‡½æ•°ç»§æ‰¿çˆ¶ç±»å±æ€§å’Œæ–¹æ³•ï¼Œå†é€šè¿‡å¯„ç”Ÿå¼ç»§æ‰¿çˆ¶ç±»åŸå‹ä¸Šçš„æ–¹æ³•å’Œå±æ€§ï¼Œå®ç°ç»§æ‰¿ã€‚æ˜¯ä¸€ç§æ¯”è¾ƒå®Œå–„çš„ç»§æ‰¿æ–¹å¼ã€‚

```js
// åŸå‹å¼ç»§æ‰¿
function createObj(o) {
  function F() {}
  F.prototype = o
  return new F()
}

function inheritPrototype(child, parent) {
  var prototype = createObj(parent.prototype)
  prototype.constructor = child
  child.prototype = prototype
}

function Parent(name) {
  this.name = name
}
Parent.prototype.sayName = function () {
  console.log(this.name)
}

function Child(name, age) {
  // æ„é€ å‡½æ•°ï¼Œç»§æ‰¿çˆ¶ç±»å±æ€§å’Œæ–¹æ³•
  Parent.call(this, name)
  this.age = age
}
inheritPrototype(Child, Parent)

var child = new Child('child', 18)
child.sayName() // child
```

### new æ“ä½œç¬¦

åœ¨ JavaScript ä¸­ï¼Œnew æ“ä½œç¬¦ç”¨äºåˆ›å»ºä¸€ä¸ªå¯¹è±¡å®ä¾‹ã€‚å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯å°†**æ„é€ å‡½æ•°ä¸æ–°å¯¹è±¡ç›¸å…³è”ï¼Œç„¶åè¿”å›è¯¥æ–°å¯¹è±¡**ã€‚

1. åˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡
2. å°†è¯¥ç©ºå¯¹è±¡çš„åŸå‹æŒ‡å‘æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡
3. å°†æ„é€ å‡½æ•°çš„ this æŒ‡å‘æ–°çš„ç©ºå¯¹è±¡
4. æ‰§è¡Œæ„é€ å‡½æ•°ï¼Œå¹¶ä¼ å‚ç»™æ„é€ å‡½æ•°
5. å¦‚æœæ„é€ å‡½æ•°è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™è¿”å›è¯¥å¯¹è±¡ï¼Œå¦åˆ™è¿”å›è¯¥ç©ºå¯¹è±¡

```js
function myNew(constructor, ...args) {
  // Object.create(proto[, propertiesObject])
  // åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œä½¿ç”¨æä¾›çš„å¯¹è±¡æ¥æä¾›ç»™æ–°å¯¹è±¡çš„__proto__
  // var o = new Object();             //1ã€æ–°å»ºç©ºå¯¹è±¡
  // o.__proto__ = Foo.prototype;      //2ã€å»ºç«‹è¿æ¥
  const obj = Object.create(constructor.prototype)
  const res = constructor.apply(obj, args)
  return res instanceof Object ? res : obj
}
```

- ä½¿ç”¨ new æ—¶ï¼Œè·Ÿå®šåé¢è·Ÿç€ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œæ¯”å¦‚ new F()çš„ F
- åŒæ—¶è¦è®©æ–°å¯¹è±¡çš„ **proto** æŒ‡å‘æ„é€ å‡½æ•°çš„ prototypeï¼Œç›´æ¥ Object.create å³å¯
- è¦æƒ³ç»§æ‰¿æ„é€ å‡½æ•°é‡Œçš„å±æ€§ï¼Œåˆ™å¿…é¡»æ‰§è¡Œä»–
- ç„¶åè¿˜å¾—ä¿®æ”¹ thisï¼Œå¹¶ä¼ å‚ä¸ºå·±æ‰€ç”¨
- æœ€ååˆ¤æ–­è¿”å›çš„å¯¹è±¡

## æ•°æ®åŠ«æŒ

### Object.defineProperty

### Proxy

```js
const proxy = new Proxy(target, handler)
```

- target æ˜¯è¦ä»£ç†çš„ç›®æ ‡å¯¹è±¡ï¼Œå¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„å¯¹è±¡ï¼Œ
- handler åˆ™æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨äºå®šä¹‰ä»£ç†å¯¹è±¡çš„è¡Œä¸ºã€‚handler ä¸­å®šä¹‰äº†ä¸€äº›ç‰¹æ®Šçš„æ–¹æ³•ï¼Œç§°ä¸ºâ€œé™·é˜±å‡½æ•°â€ï¼ˆtrap functionsï¼‰ï¼Œå½“ä»£ç†å¯¹è±¡è¢«æ“ä½œæ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨è¿™äº›é™·é˜±å‡½æ•°æ¥å®ç°ä»£ç†çš„è¡Œä¸ºã€‚

ä¸‹é¢æ˜¯ handler ä¸­å¸¸ç”¨çš„é™·é˜±å‡½æ•°ï¼š

- get(target, property, receiver)ï¼šå½“è¯»å–ä»£ç†å¯¹è±¡çš„å±æ€§æ—¶è°ƒç”¨ã€‚
- set(target, property, value, receiver)ï¼šå½“è®¾ç½®ä»£ç†å¯¹è±¡çš„å±æ€§æ—¶è°ƒç”¨ã€‚
- apply(target, thisArg, argumentsList)ï¼šå½“ä»£ç†å¯¹è±¡ä½œä¸ºå‡½æ•°è¢«è°ƒç”¨æ—¶è°ƒç”¨ã€‚
- construct(target, argumentsList, newTarget)ï¼šå½“ä»£ç†å¯¹è±¡ä½œä¸ºæ„é€ å‡½æ•°è¢«è°ƒç”¨æ—¶è°ƒç”¨ã€‚
- has(target, property)ï¼šå½“ä½¿ç”¨ in æ“ä½œç¬¦æˆ– Reflect.has() æ–¹æ³•æ£€æŸ¥å±æ€§æ˜¯å¦å­˜åœ¨æ—¶è°ƒç”¨ã€‚
- deleteProperty(target, property)ï¼šå½“ä½¿ç”¨ delete æ“ä½œç¬¦æˆ– Reflect.deleteProperty() æ–¹æ³•åˆ é™¤å±æ€§æ—¶è°ƒç”¨ã€‚
- getOwnPropertyDescriptor(target, property)ï¼šå½“ä½¿ç”¨ Object.getOwnPropertyDescriptor() æ–¹æ³•è·å–å±æ€§æè¿°ç¬¦æ—¶è°ƒç”¨ã€‚
- defineProperty(target, property, descriptor)ï¼šå½“ä½¿ç”¨ Object.defineProperty() æˆ– Object.defineProperties() æ–¹æ³•å®šä¹‰å±æ€§æ—¶è°ƒç”¨ã€‚

é™¤äº†ä»¥ä¸Šé™·é˜±å‡½æ•°å¤–ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–çš„é™·é˜±å‡½æ•°ï¼Œå¦‚ getPrototypeOf()ã€setPrototypeOf()ã€isExtensible()ã€preventExtensions()ã€getOwnPropertyNames()ã€getPrototypeOf() ç­‰

## å¼‚æ­¥åŠ è½½

### å¼‚æ­¥åŠ è½½å›¾ç‰‡

```js
function loadImgAsync(url) {
  return new Promise((resolve, reject) => {
    const img = new Image()
    img.onload = () => {
      resolve(img)
    }
    img.onerror = () => {
      reject(new Error('could not load img at ' + url))
    }
    img.src = url
  })
}
```

### æ— æ‰€ä¸åœ¨çš„ç»Ÿè®¡ä»£ç 

```js
// æ— æ‰€ä¸åœ¨çš„ç™¾åº¦ç»Ÿè®¡ä»£ç ï¼Œè¿™ä¾¿æ˜¯å¸¸è§„çš„æŒ‰éœ€åŠ è½½ï¼Œç”¨çš„æ—¶å€™æ‰§è¡Œä»¥ä¸‹å°±å¥½(å¯ä»¥ç”¨äº‹ä»¶è§¦å‘)
;(function () {
  var hm = document.createElement('script')
  hm.src = 'https://hm.baidu.com/hm.js?<xxxxx>'
  var s = document.getElementsByTagName('script')[0]
  s.parentNode.insertBefore(hm, s)
})()
```

### å®ç° vue é¡¹ç›®ä¸­çš„æŒ‰éœ€åŠ è½½

```js
function load(componentName, path) {
  return new Promise(function (resolve, reject) {
    var script = document.createElement('script')
    script.src = path
    script.async = true
    script.onload = function () {
      // é€šè¿‡Vue.componentéªŒè¯ç»„ä»¶ï¼Œå­˜åœ¨å°±resolve,å¦åˆ™reject
      var component = Vue.component(componentName)
      if (component) {
        resolve(component)
      } else {
        reject()
      }
    }
    script.onerror = reject
    document.body.appendChild(script)
  })
}

var router = new VueRouter({
  routes: [
    {
      path: '/home',
      component: {
        template: '<div>Home page</div>',
      },
    },
    {
      path: '/about',
      component: function (resolve, reject) {
        // ä½¿ç”¨è‡ªå®šä¹‰çš„lodaå‡½æ•°åŠ è½½
        load('about', 'about.js').then(resolve, reject)
      },
    },
  ],
})

var app = new Vue({
  el: '#app',
  router: router,
})
```

### é…åˆ webpack çš„æŒ‰éœ€åŠ è½½

```js
// é…åˆwebpack
const router = new VueRouter({
  routes: [
    { path: '/home', component: Home },
    {
      path: '/about',
      // Vue.jsæ”¯æŒcomponentå®šä¹‰ä¸ºä¸€ä¸ªå‡½æ•°ï¼šfunction (resolve) {}ï¼Œ
      // åœ¨å‡½æ•°å†…ï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼node.jsçš„åº“å¼•å…¥æ¨¡å¼
      // è¿™ä¸ªç‰¹æ®Šçš„requireè¯­æ³•å‘Šè¯‰webpackè‡ªåŠ¨å°†ç¼–è¯‘åçš„ä»£ç åˆ†å‰²æˆä¸åŒçš„å—ï¼Œè¿™äº›å—å°†é€šè¿‡æŒ‰éœ€è‡ªåŠ¨ä¸‹è½½ã€‚
      component: function (resolve) {
        require(['./components/about'], resolve)
      },
    },
    { path: '/', redirect: '/home' },
  ],
})

// ç°åœ¨é¡¹ç›®ä½¿ç”¨è¿™ç§æ–¹å¼
// 1. import() ä¸åŒäº importï¼Œè¯¥æ–¹æ³•ä¸ºäº†åŠ¨æ€åŠ è½½æ¨¡å—è€Œå¼•å…¥çš„æ–°è¯­æ³•
// 2. import() è¿”å›ç»“æœæ˜¯ Promise
const router = new VueRouter({
  routes: [
    {
      path: `${rootPath}/pages`,
      redirect: { name: 'Home' },
      // import() ç”¨äºåŠ¨æ€åŠ è½½æ¨¡å—ï¼Œå…¶å¼•ç”¨çš„æ¨¡å—åŠå­æ¨¡å—ä¼šè¢«åˆ†å‰²æ‰“åŒ…æˆä¸€ä¸ªç‹¬ç«‹çš„ chunkã€‚
      component: () => import('views/layout'),
      children: [
        {
          path: 'home',
          // Webpack è¿˜å…è®¸ä»¥æ³¨é‡Šçš„æ–¹å¼ä¼ å‚ï¼Œè¿›è€Œæ›´å¥½çš„ç”Ÿæˆ chunkã€‚
          component: () =>
            import(
              /* webpackInclude: /\.json$/ */
              /* webpackExclude: /\.noimport\.json$/ */
              /* webpackChunkName: "my-chunk-name" */
              /* webpackMode: "lazy" */
              'views/blank'
            ),
          meta: { title: 'é¦–é¡µ', isHomePage: true },
          name: 'Home',
        },
      ],
    },
  ],
})

// webpackä¸­ä½¿ç”¨çš„ä¸‰ç§å¼‚æ­¥åŠ è½½æ–¹å¼
// 1ã€System.import()ï¼› å·²åºŸé™¤ï¼Œä¸æ¨è
// 2ã€require.ensure()ï¼› v1å’Œv2å‡å¯ä½¿ç”¨
// 3ã€import()ï¼›v2æ”¯æŒï¼Œv1ä¸æ”¯æŒ
```

### webpack æŒ‰éœ€åŠ è½½å®ç°

#### åŒæ­¥ä»£ç åˆ†å‰² require.ensure

åŒæ­¥ä»£ç åˆ†å‰²æ˜¯é€šè¿‡ä½¿ç”¨ require.ensure æ–¹æ³•æ¥å®ç°çš„ã€‚require.ensure æ–¹æ³•æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼šéœ€è¦åˆ†å‰²çš„æ¨¡å—ï¼Œåˆ†å‰²åçš„æ¨¡å—åï¼Œä»¥åŠåˆ†å‰²åçš„æ¨¡å—å¯¹åº”çš„ chunk çš„åç§°

```js
require.ensure(
  [],
  function (require) {
    var module = require('./module')
  },
  'module'
)
```

è¿™æ®µä»£ç è¡¨ç¤ºå°†./module æ¨¡å—è¿›è¡Œåˆ†å‰²ï¼Œåˆ†å‰²åçš„æ¨¡å—åä¸º moduleï¼Œå¯¹åº”çš„ chunk åç§°ä¹Ÿä¸º moduleã€‚

```js
// æ‰‹åŠ¨å®ç°ä¸€ä¸ªrequrieEnsure å‡½æ•°
// è¿™é‡Œæ˜¯å¹¶å‘ï¼Œå‘èµ·å¤šä¸ªè¯·æ±‚ï¼Œè¿˜å¯ä»¥å®ç°ç±»ä¼¼ï¼ŒpromiseAllæˆ–è€…promiseLimit
function requireEnsure(dependencies, callback) {
  var module = {}
  var loadedDependencies = 0

  function loadDependency(dependencyIndex) {
    var dependency = dependencies[dependencyIndex]
    var script = document.createElement('script')
    script.src = dependency

    script.onload = function () {
      loadedDependencies++
      if (loadedDependencies === dependencies.length) {
        callback(module)
      }
    }

    document.head.appendChild(script)
  }

  for (var i = 0; i < dependencies.length; i++) {
    loadDependency(i)
  }
}
```

#### å¼‚æ­¥ä»£ç åˆ†å‰² import()

å¼‚æ­¥ä»£ç åˆ†å‰²æ˜¯é€šè¿‡ä½¿ç”¨ import()æ–¹æ³•æ¥å®ç°çš„ã€‚import()æ–¹æ³•è¿”å›ä¸€ä¸ª Promise å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨ then æ–¹æ³•æ¥è·å–åˆ†å‰²åçš„æ¨¡å—

```js
import('./module').then(function (module) {
  // do something with module
})
```

è¿™æ®µä»£ç è¡¨ç¤ºå°†./module æ¨¡å—è¿›è¡Œåˆ†å‰²ï¼Œå¹¶åœ¨åˆ†å‰²åçš„æ¨¡å—åŠ è½½å®Œæˆåæ‰§è¡Œå›è°ƒå‡½æ•°ã€‚

**æ‰‹åŠ¨å®ç°ä¸€ä¸ª import()å‡½æ•°**

```js
async function import(moduleName) {
  const moduleUrl = `/modules/${moduleName}.js`;
  const response = await fetch(moduleUrl);
  const moduleSource = await response.text();
  const moduleExports = eval(moduleSource);
  return moduleExports.default;
}
```

### webpack æ’ä»¶

è¯¥æ’ä»¶ä¼šåœ¨ webpack ç¼–è¯‘å®Œæˆåï¼Œéå†æ‰€æœ‰ç”Ÿæˆçš„ JS æ–‡ä»¶ï¼ŒæŸ¥æ‰¾å…¶ä¸­çš„ setTimeout å’Œ setInterval è°ƒç”¨ï¼Œç„¶åå°†å®ƒä»¬æ”¶é›†åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ã€‚å¦‚æœæŒ‡å®šäº† outputFile é€‰é¡¹ï¼Œåˆ™å°†ç»“æœä¿å­˜åˆ°æŒ‡å®šæ–‡ä»¶ä¸­ã€‚å¦åˆ™ï¼Œåªè¾“å‡ºæ”¶é›†åˆ°çš„å®šæ—¶å™¨æ•°é‡ã€‚

```js
const fs = require('fs')

class TimerCollectorPlugin {
  constructor(options) {
    this.options = options || {}
    this.timers = []
  }

  apply(compiler) {
    compiler.hooks.emit.tapAsync('TimerCollectorPlugin', (compilation, callback) => {
      const assets = compilation.assets
      const keys = Object.keys(assets)
      for (let i = 0; i < keys.length; i++) {
        const key = keys[i]
        if (key.endsWith('.js')) {
          const content = assets[key].source()
          const regex = /setTimeout|setInterval/g
          let match
          while ((match = regex.exec(content)) !== null) {
            this.timers.push(match[0])
          }
        }
      }
      if (this.options.outputFile) {
        fs.writeFile(this.options.outputFile, JSON.stringify(this.timers), (err) => {
          if (err) {
            console.error(err)
          } else {
            console.log(
              `TimerCollectorPlugin: ${this.timers.length} timers collected and saved to ${this.options.outputFile}`
            )
          }
          callback()
        })
      } else {
        console.log(`TimerCollectorPlugin: ${this.timers.length} timers collected`)
        callback()
      }
    })
  }
}

module.exports = TimerCollectorPlugin
```

ä½¿ç”¨æ’ä»¶

```js
const TimerCollectorPlugin = require('./TimerCollectorPlugin')

module.exports = {
  // ...
  plugins: [
    new TimerCollectorPlugin({
      outputFile: 'timers.json', // å¯é€‰ï¼ŒæŒ‡å®šè¾“å‡ºæ–‡ä»¶è·¯å¾„
    }),
  ],
}
```

## äº‹ä»¶å¾ªç¯

## ç©ºé—´å ç”¨

- 1GB = 1024MB = 1024 _ 1024Kb = 1024 _ 1024 \* 1024Byteï¼ˆå­—èŠ‚ï¼‰
- ä¸€ä¸ªå­—èŠ‚ å°±æ˜¯ 8 ä½
- æ•´æ•°ï¼ˆintï¼‰ï¼šé€šå¸¸å ç”¨ 4 ä¸ªå­—èŠ‚ï¼ˆ32 ä½ï¼‰ï¼Œä½†åœ¨æŸäº›ç¼–ç¨‹è¯­è¨€ä¸­å¯èƒ½å ç”¨ 2 ä¸ªæˆ– 8 ä¸ªå­—èŠ‚ã€‚
- é•¿æ•´æ•°ï¼ˆlongï¼‰ï¼šé€šå¸¸å ç”¨ 8 ä¸ªå­—èŠ‚ï¼ˆ64 ä½ï¼‰ï¼Œä½†åœ¨æŸäº›ç¼–ç¨‹è¯­è¨€ä¸­å¯èƒ½å ç”¨ 4 ä¸ªæˆ– 16 ä¸ªå­—èŠ‚ã€‚
- æµ®ç‚¹æ•°ï¼ˆfloatï¼‰ï¼šé€šå¸¸å ç”¨ 4 ä¸ªå­—èŠ‚ï¼ˆ32 ä½ï¼‰ï¼Œä½†åœ¨æŸäº›ç¼–ç¨‹è¯­è¨€ä¸­å¯èƒ½å ç”¨ 8 ä¸ªå­—èŠ‚ã€‚
- åŒç²¾åº¦æµ®ç‚¹æ•°ï¼ˆdoubleï¼‰ï¼šé€šå¸¸å ç”¨ 8 ä¸ªå­—èŠ‚ï¼ˆ64 ä½ï¼‰ï¼Œä½†åœ¨æŸäº›ç¼–ç¨‹è¯­è¨€ä¸­å¯èƒ½å ç”¨ 4 ä¸ªæˆ– 16 ä¸ªå­—èŠ‚ã€‚
- å­—ç¬¦ï¼ˆcharï¼‰ï¼šé€šå¸¸å ç”¨ 1 ä¸ªå­—èŠ‚ï¼Œä½†åœ¨æŸäº›ç¼–ç¨‹è¯­è¨€ä¸­å¯èƒ½å ç”¨ 2 ä¸ªæˆ–æ›´å¤šå­—èŠ‚ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™äº›æ•°å­—ç±»å‹çš„å¤§å°å¯èƒ½å› ç¼–ç¨‹è¯­è¨€ã€ç¡¬ä»¶å¹³å°å’Œæ“ä½œç³»ç»Ÿè€Œå¼‚ã€‚

```js
function memorySizeOf(obj) {
  var bytes = 0

  function sizeOf(obj) {
    if (obj !== null && obj !== undefined) {
      switch (typeof obj) {
        case 'number':
          bytes += 8
          break
        case 'string':
          bytes += obj.length * 2
          break
        case 'boolean':
          bytes += 4
          break
        case 'object':
          var objClass = Object.prototype.toString.call(obj).slice(8, -1)
          if (objClass === 'Object' || objClass === 'Array') {
            for (var key in obj) {
              if (!obj.hasOwnProperty(key)) continue
              sizeOf(obj[key])
            }
          } else bytes += obj.toString().length * 2
          break
      }
    }
    return bytes
  }

  function formatByteSize(bytes) {
    if (bytes < 1024) return bytes + ' bytes'
    else if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(3) + ' KiB'
    else if (bytes < 1024 * 1024 * 1024) return (bytes / (1024 * 1024)).toFixed(3) + ' MiB'
    else return (bytes / (1024 * 1024 * 1024 * 1024)).toFixed(3) + ' GiB'
  }

  return formatByteSize(sizeOf(obj))
}
```
