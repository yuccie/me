---
title: '浏览器相关'
date: Sun May 14 2023 18:46:37 GMT+0800 (中国标准时间)
lastmod: '2023-05-14'
tags: ['浏览器']
draft: false
summary: '这短短的一生，我们总要做一些有意义的事情。。。'
layout: PostSimple
bibliography: references-data.bib
canonicalUrl: https://dume.vercel.app/blog/2023/browser
---

## 输入 url 到页面显示，都发生了什么

1. 当用户在地址栏中输入一个查询关键字时，地址栏会判断输入的关键字是搜索内容，还是请求的 URL，进而处理拼装成对应的 URL 格式。（按下回车后，浏览器给当前页面一次执行 beforeunload 事件的机会，意味着你可以在页面退出前做些什么）
2. 浏览器进程会通过进程间通信（IPC）把 拼装好的 URL 请求发送至网络进程，网络进程首先查找本地是否有缓存(这里缓存可以理解为资源和域名缓存等)，有则直接返回，没有则进行 DNS 解析获取 ip，如果是 https 则还需要建立 TLS 连接。
3. 浏览器构建请求头(头和行)，发送给服务器，服务器解析请求头，然后返回响应头，网络进程收到响应头便开始解析，需要根据 code 码做适当处理，比如 301，302 等重定向的，就会获取 Location 字段，重新发起请求。还会根据响应头里的`content-type:application/octet-stream;charset=UTF-8`来判断是下载还是普通页面。下载的话就直接交给下载管理器，同时该 URL 的导航过程也就结束了。如果是页面，因为页面是在渲染进程里，所以下一步就是准备渲染进程
4. 默认情况下，Chrome 会为每个标签页分配一个渲染进程，但一个站点(相同协议和根域名，比同源要求低)下的页面一般共用一个渲染进程，准备好了渲染进程，但现在页面资源还在网络进程那，所以下一步就需要提交文档。
5. 所谓提交文档，就是指浏览器进程将网络进程接收到的 HTML 数据提交给渲染进程（其实浏览器收到网络进程的响应头后，就给渲染进程发消息，说你要准备渲染页面啦，渲染进程收到消息就会与网络进程建立连接来获取页面数据，等页面数据传输完毕后，会告诉浏览器主进程，主进程收到确认提交消息后就会更新浏览器界面状态，包括了安全状态、地址栏的 URL、前进后退的历史状态，并更新 Web 页面）
6. 一旦主进程收到确认提交消息后，渲染进程就开始页面解析及子资源加载了。
7. 解析 HTML 文件：浏览器首先会从网络中获取 HTML 文件，然后解析该文件，构建一棵 DOM 树。
8. 解析 CSS 文件：浏览器会根据 HTML 中的 link 和 style 标签获取 CSS 文件，然后解析该文件，构建一棵 CSSOM 树。
9. 构建渲染树：浏览器会将 DOM 树和 CSSOM 树合并成一棵渲染树，渲染树只包含需要显示的节点和样式信息。
10. 布局：浏览器会根据渲染树中每个节点的大小、位置等信息，计算出每个节点在屏幕上的准确位置。
11. 绘制：浏览器会遍历渲染树，将每个节点绘制出来，生成位图。
12. 合成：浏览器会将位图合成为一张完整的页面，然后将该页面显示在屏幕上
13. 而一旦页面生成完成，渲染进程会发消息给主进程，然后浏览器主进程就会停止标签图标的加载动画。
